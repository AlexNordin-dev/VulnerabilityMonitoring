@model VulnerableProjectViewModels
@using System.Text.RegularExpressions

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}




@{
    // Hämta toastNotification från TempData om det finns
    var response = TempData["ToastNotification"] as ToastNotification;

}

@section scripts
{
    @if (response != null)
    {
        // Skapa en JavaScript-variabel som innehåller toastNotification
        <script>
            var toastNotification = {
                status: '@response.status',
                message: '@response.message'
            };
            console.log('sssssss',toastNotification.status);
        </script>
    }
    <script>
        $(document).ready(function () {
            // Om toastNotification finns, visa toast
            if (toastNotification) {
                showToastNotification(toastNotification.status, toastNotification.message);
            }
        });
    </script>

}







<div class="content">
    <div class="container">

        <div>
            <h1 class="fs-4">Vulnerability Scan Results: </h1>
        </div>

        <!-- Body text -->
        <div class="row mb-5">
            @if (@Model == null)
            {
                <p>Hello :) </p>
            }
            else
            {
                @if (@Model.VulnerableProjectPackage.Any())
                {
                    <div class="col-md-12 col-lg-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <span><i class="fas fa-cube"></i> Project: @Model.ProjectSloName</span> <br />
                                    <span><i class="fas fa-clock"></i> Run time: @DateTime.Now</span>
                                </div>
                                <div>
                                </div>
                            </div>
                            <div class="card-body">

                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                @* <th>Project Name</th> *@
                                                <th>Package Name</th>
                                                <th>Requested Version</th>
                                                <th>Resolved Version</th>
                                                <th>Severity</th>
                                                <th>Advisory URL</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var package in Model.VulnerableProjectPackage)
                                            {
                                                <tr>

                                                    <td>
                                                        <span class="text-info">                                                          
                                                            @package.ProjectName
                                                        </span>
                                                        @package.PackageName
                                                    </td>
                                                    <td>@package.RequestedVersion</td>
                                                    <td>@package.ResolvedVersion</td>
                                                    <td>
                                                        @switch (@package.Severity)
                                                        {
                                                            case "High":
                                                                <span style="color: red;">@package.Severity</span>
                                                                break;
                                                            case "Moderate":
                                                                <span style="color: orange;">@package.Severity</span>
                                                                break;
                                                            case "Critical":
                                                                <span style="color: purple;">@package.Severity</span>
                                                                break;
                                                            case "Low":
                                                                <span style="color: darkcyan;">@package.Severity</span>
                                                                break;
                                                            default:
                                                                @package.Severity
                                                                break;
                                                        }
                                                    </td>
                                                    <td>  <a href="@package.AdvisoryURL" target="_blank">@package.AdvisoryURL</a></td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                }
                else
                {
                    <p>No vulnerabilities found.</p>
                }

            }

        </div>

    </div>
</div>